name: CI

on:
  pull_request:
  push:
    branches:
      - main
      - new-ci
    paths-ignore:
      - '**/.md'
  workflow_dispatch:

jobs:
  build-core:
    name: Build Core (${{ matrix.platform }})
    runs-on: ${{ matrix.platform }}
    strategy:
      fail-fast: true
      matrix:
        platform: [ubuntu-latest, macos-latest, windows-latest]
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2
      
      - name: Install Rust stable
        uses: actions-rs/toolchain@v1
        with:
          toolchain: stable
          profile: minimal
          override: true
          components: rustfmt, rust-src

      - name: Build Core
        run: cargo build --release

# tests:
#   name: ${{ matrix.make.name }} (${{ matrix.os }})
#   runs-on: ${{ matrix.os }}
#   strategy:
#     fail-fast: false
#     matrix:
#       os: [ubuntu-latest, macos-latest]
#       rust: [stable]
#       make:
#         - name: Clippy
#           task: "check-clippy"
#         - name: Unit tests
#           task: "build-all-test run-all-unit-test"
#         - name: Doc tests
#           task: "run-all-doc-test"
#       include:
#         - os: ubuntu-latest
#           sccache-path: /home/runner/.cache/sccache
#         - os: macos-latest
#           sccache-path: /Users/runner/Library/Caches/Mozilla.sccache
#       exclude:
#         - os: macos-latest
#           rust: stable
#           make:
#             name: Clippy